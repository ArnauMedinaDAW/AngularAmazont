<main>
  @if(!isFromCategories){
    <div class="container mt-4">
      <div class="row justify-content-center">
        <div class="col-md-6">
          <div class="input-group">
            <input #searchInput type="text" class="form-control" placeholder="Buscar productos tecnológicos...">
            <button class="btn btn-primary" (click)="buscarProducte(searchInput.value)">
              <i class="fas fa-search"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading indicator -->
    @if(loading){
      <div class="text-center my-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Cargando...</span>
        </div>
        <p class="mt-2">Cargando productos...</p>
      </div>
    }

    <!-- Error message -->
    @if(error){
      <div class="alert alert-danger text-center my-5">
        {{ error }}
      </div>
    }

    <!-- Products slider -->
    @if(!loading && !error && productsFiltrats.length > 0){
      <div class="slider-container">
        <button 
          class="slider-btn prev"
          (click)="anteriorSlide()"
        >
          <i class="fas fa-chevron-left"></i>
        </button>
      
        <div class="row">
          @for(product of grupProductes; track product.id){
            <div class="product-card" (click)="verDetalles(product)">
              <img [src]="product.imagen" [alt]="product.nombre" class="product-image">
              <div class="product-info">
                <h3>{{ product.nombre }}</h3>
                <div class="price-container">
                  <span class="price">{{ product.precio }}€</span>
                  <span class="discount">
                    {{ product.nota }}/10
                  </span>
                </div>
              </div>
            </div> 
          }
        </div>
      
        <button 
          class="slider-btn next" 
          (click)="seguentSlide()"
        >
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    }

    <!-- No products found -->
    @if(!loading && !error && productsFiltrats.length === 0){
      <div class="alert alert-info text-center my-5">
        No se encontraron productos que coincidan con su búsqueda.
      </div>
    }
  }@else{
    <!-- Product detail view remains the same -->
    <div class="product-detail-container">
      <div class="product-header">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="#">Inicio</a></li>
            <li class="breadcrumb-item"><a href="#">Productos</a></li>
            <li class="breadcrumb-item active" aria-current="page">{{ product.nombre }}</li>
          </ol>
        </nav>
      </div>

      <div class="product-main">
        <div class="product-gallery">
          <div class="main-image">
            <img [src]="product.imagen" [alt]="product.nombre" class="img-fluid">
          </div>
          <div class="thumbnail-gallery">
            <img [src]="product.imagen" [alt]="product.nombre" class="thumbnail active">
            <img [src]="product.imagen" [alt]="product.nombre" class="thumbnail">
            <img [src]="product.imagen" [alt]="product.nombre" class="thumbnail">
            <img [src]="product.imagen" [alt]="product.nombre" class="thumbnail">
          </div>
        </div>

        <div class="product-info">
          <div class="product-title">
            <h1>{{ product.nombre }}</h1>
            <div class="rating-badge">
              <i class="fas fa-star"></i>
              <span>{{ product.nota }}/10</span>
            </div>
          </div>

          <div class="product-price">
            <span class="current-price">{{ product.precio }}€</span>
            <span class="original-price">{{ product.precio * 1.2 | number:'1.2-2' }}€</span>
            <span class="discount-badge">-20%</span>
          </div>

          <div class="product-description">
            <p>{{ product.descripcion }}</p>
            <ul class="features-list">
              <li><i class="fas fa-check"></i> Garantía de 2 años</li>
              <li><i class="fas fa-check"></i> Envío gratuito</li>
              <li><i class="fas fa-check"></i> Devolución en 30 días</li>
            </ul>
          </div>

          <div class="product-actions">
            <div class="quantity-selector">
              <button class="btn-quantity" (click)="decrementQuantity()">-</button>
              <span class="quantity-value">{{quantity}}</span>
              <button class="btn-quantity" (click)="incrementQuantity()">+</button>
            </div>
            <button class="btn-add-cart" (click)="addToCart(product, quantity)">
              <i class="bi bi-cart-plus"></i>
              Añadir al carrito
            </button>
            <button class="btn-wishlist">
              <i class="bi bi-heart"></i>
            </button>
          </div>

          <div class="product-meta">
            <div class="meta-item">
              <i class="bi bi-truck"></i>
              <span>Envío gratis</span>
            </div>
            <div class="meta-item">
              <i class="bi bi-shield-check"></i>
              <span>Garantía 2 años</span>
            </div>
            <div class="meta-item">
              <i class="bi bi-arrow-repeat"></i>
              <span>Devolución gratis</span>
            </div>
          </div>
        </div>
      </div>

      <div class="product-details-tabs">
        <ul class="nav nav-tabs">
          <li class="nav-item">
            <a class="nav-link" [class.active]="!showReviews" (click)="showReviews = false" style="cursor: pointer">
              <i class="bi bi-info-circle"></i> Descripción
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" [class.active]="showReviews" (click)="toggleReviews()" style="cursor: pointer">
              <!-- <i class="bi bi-star"></i> Reseñas ({{comments.length}}) -->
            </a>
          </li>
        </ul>

        <div class="tab-content">
          <div *ngIf="!showReviews">
            <div class="features-grid">
              <div class="feature-item">
                <i class="bi bi-shield-check"></i>
                <h4>Calidad Premium</h4>
                <p>Producto de alta calidad con materiales seleccionados</p>
              </div>
              <div class="feature-item">
                <i class="bi bi-lightning"></i>
                <h4>Rendimiento</h4>
                <p>Diseñado para ofrecer el máximo rendimiento</p>
              </div>
              <div class="feature-item">
                <i class="bi bi-gear"></i>
                <h4>Garantía</h4>
                <p>2 años de garantía en todos los componentes</p>
              </div>
            </div>
          </div>

          <div *ngIf="showReviews" class="reviews-section">
            <div class="reviews-summary">
              <div class="rating-overview">
                <div class="overall-rating">
                  <div class="rating-number">{{product.nota}}</div>
                  <div class="stars">
                    <i class="bi bi-star-fill"></i>
                    <i class="bi bi-star-fill"></i>
                    <i class="bi bi-star-fill"></i>
                    <i class="bi bi-star-fill"></i>
                    <i class="bi bi-star-half"></i>
                  </div>
                  <!-- <div class="total-reviews">{{comments.length}} reseñas</div> -->
                </div>
              </div>
            </div>

            <div class="reviews-list">
              <!-- <div *ngFor="let comment of comments" class="review-item">
                <div class="review-header">
                  <div class="reviewer-info">
                    <i class="bi bi-person-circle"></i>
                    <div>
                      <h5>{{comment.user}}</h5>
                      <div class="review-stars">
                        <i *ngFor="let i of [1,2,3,4,5]" 
                           class="bi" 
                           [ngClass]="i <= comment.rating ? 'bi-star-fill' : 'bi-star'">
                        </i>
                      </div>
                    </div>
                  </div>
                </div>
                <p class="review-text">{{comment.text}}</p>
              </div> -->
            </div>
          </div>
        </div>
      </div>
    </div>
  }
</main>
